!function(e){e.hisrc={bandwidth:null,connectionTestResult:null,connectionKbps:null,connectionType:null,devicePixelRatio:null},e.hisrc.defaults={useTransparentGif:!1,transparentGifSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAMz/AAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",minKbpsForHighBandwidth:300,speedTestUri:"https://<use-your-own-domain>.com/put-a-50K-file-here/50K",speedTestKB:50,speedTestExpireMinutes:30,forcedBandwidth:!1},e.hisrc.speedTest=function(){e(window).hisrc()},e.fn.hisrc=function(t){var i=e.extend({callback:function(){}},e.hisrc.defaults,t),n=e(this),s=navigator.connection||{type:0},r=3==s.type||4==s.type||/^[23]g$/.test(s.type);if(e.hisrc.devicePixelRatio=1,void 0!==window.devicePixelRatio)e.hisrc.devicePixelRatio=window.devicePixelRatio;else if(void 0!==window.matchMedia)for(var c=1;2>=c;c+=.5)window.matchMedia("(min-resolution: "+c+"dppx)").matches&&(e.hisrc.devicePixelRatio=c);var o,a=i.speedTestUri,d="loading",h="complete",l="fsjs",p=function(){if(!o){if(i.forcedBandwidth)return e.hisrc.bandwidth=i.forcedBandwidth,e.hisrc.connectionTestResult="forced",o=h,n.trigger("speedTestComplete.hisrc"),void 0;if(1===e.hisrc.devicePixelRatio)return e.hisrc.connectionTestResult="skip",o=h,n.trigger("speedTestComplete.hisrc"),void 0;if(e.hisrc.connectionType=s.type,r)return e.hisrc.connectionTestResult="connTypeSlow",o=h,n.trigger("speedTestComplete.hisrc"),void 0;try{var t=JSON.parse(localStorage.getItem(l));if(null!==t&&(new Date).getTime()<t.exp)return e.hisrc.bandwidth=t.bw,e.hisrc.connectionKbps=t.kbps,e.hisrc.connectionTestResult="localStorage",o=h,n.trigger("speedTestComplete.hisrc"),void 0}catch(c){}var p,w,f,g=document.createElement("img");g.onload=function(){p=(new Date).getTime();var t=(p-w)/1e3;t=t>1?t:1,e.hisrc.connectionKbps=8*1024*i.speedTestKB/t/1024,e.hisrc.bandwidth=e.hisrc.connectionKbps>=i.minKbpsForHighBandwidth?"high":"low",u("networkSuccess")},g.onerror=function(){u("networkError",5)},g.onabort=function(){u("networkAbort",5)},w=(new Date).getTime(),o=d,"https:"===document.location.protocol&&(a=a.replace("http:","https:")),g.src=a+"?r="+Math.random(),f=1e3*(8*i.speedTestKB/i.minKbpsForHighBandwidth)+350,setTimeout(function(){u("networkSlow")},f)}},u=function(t,s){if(o!==h){o=h,e.hisrc.connectionTestResult=t;try{s||(s=i.speedTestExpireMinutes);var r={kbps:e.hisrc.connectionKbps,bw:e.hisrc.bandwidth,exp:(new Date).getTime()+6e4*s};localStorage.setItem(l,JSON.stringify(r))}catch(c){}n.trigger("speedTestComplete.hisrc")}},w=function(e,t){i.useTransparentGif?e.attr("src",i.transparentGifSrc).css("max-height","100%").css("max-width","100%").css("background",'url("'+t+'") no-repeat 0 0').css("background-size","contain"):e.attr("src",t)};return i.callback.call(this),n.each(function(){var t=e(this);t.data("m1src")||t.data("m1src",t.attr("src")),!t.attr("width")&&t.width()>0&&t.attr("width",t.width()),!t.attr("height")&&t.height()>0&&t.attr("height",t.height()),t.on("speedTestComplete.hisrc",function(){o===h&&(r?t.attr("src",t.data("m1src")):e.hisrc.devicePixelRatio>1&&"high"===e.hisrc.bandwidth?w(t,t.data("2x")):w(t,t.data("1x")),t.off("speedTestComplete.hisrc"))})}),p(),n}}(jQuery);